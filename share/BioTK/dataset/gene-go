#!/usr/bin/env bash

annotation_type="canonical"

while getopts cp opt; do
    case $opt in
        c) COLLAPSE=y ;;
        p) annotation_type="predicted" ;;
        ?) echo "unrecognized option" 1>&2 ; exit 1 ;;
    esac
done
shift $((OPTIND - 1))

path="$BTK_DATA/ncbi/gene/gene-go/${annotation_type}/${1}.gz"
if [ ! -f "$path" ]; then
    echo "Annotation doesn't exist."
    echo "* type: $annotation_type"
    echo "* taxon: $taxon_id"
fi 1>&2

zcat "$path" \
    |   if [[ ! -z "$COLLAPSE" ]]; then
            sed 1d \
                | tawk '{print $3,$2}' \
                | sort -u \
                | datamash -g 1 collapse 2 \
                | tr ',' '\t'
        else
            cat
        fi

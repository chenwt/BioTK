#!/usr/bin/env bash

accession=$(echo $1 | tr '[:upper:]' '[:lower:]')
path="$BTK_DATA/ontology/${accession}.obo"
if [ ! -f $path ]; then
    curl -o "$path" "http://www.berkeleybop.org/ontologies/${accession}.obo"
fi

export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8

python <(cat <<EOF
import sys
for line in sys.stdin:
    line = line.strip("\n")
    if line.startswith("[") and line.endswith("]"):
        id = None
        name = None
        type = line[1:-1]
    elif line.startswith("id:"):
        id = line.split(": ", 1)[1]
    elif line.startswith("name:"):
        name = line.split(": ", 1)[1]
    elif not line:
        if type == "Term" and id and name:
            print(id, name, sep="\t")
EOF) < $path

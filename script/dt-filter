#!/usr/bin/env bash

process() {
    awk -vmin=$1 -f <(cat <<"EOF"
BEGIN { IFS=FS="\t" }
{
    n=0
    for (i=2; i<=NF; i++) {
        if (!(($i == "") || ($i == "nan"))) {
            n+=1
        }
    }
    if (n >= min) {
        print
    }
}
EOF
)
}
export -f process

min_valid=1
while getopts m: opt; do
    case $opt in
        m) min_valid="$OPTARG" ;;
    esac
done
shift $((OPTIND - 1))

dt wrap parallel -k --pipe process $min_valid
